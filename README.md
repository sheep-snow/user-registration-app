# User Registration App

Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã®ã‚µã‚¤ãƒ³ã‚¤ãƒ³æ©Ÿèƒ½ã‚’å‚™ãˆãŸãƒ©ã‚¤ã‚»ãƒ³ã‚¹è²©å£²Webã‚µãƒ¼ãƒ“ã‚¹

## æ¦‚è¦

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒGoogleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã€æ±ºæ¸ˆã‚’é€šã˜ã¦ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å–å¾—ã§ãã‚‹ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹Webã‚µãƒ¼ãƒ“ã‚¹ã€‚

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### å‰ææ¡ä»¶
- AWS CLIè¨­å®šæ¸ˆã¿
- Node.js 18+
- Dockerï¼ˆLambdaç”¨ï¼‰

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
```bash
git clone <repository-url>
cd user-ragistration-app
```

### 2. ã‚¤ãƒ³ãƒ•ãƒ©ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
cd infrastructure
npm install
cp cdk.env.example cdk.env
# cdk.envã‚’ç·¨é›†ï¼ˆå¾Œè¿°ã®è¨­å®šé …ç›®å‚ç…§ï¼‰
cdk bootstrap
cdk deploy --context env=dev --all
```

### 3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
```bash
cd ../frontend
npm install
cp .env.example .env
# .envã‚’ç·¨é›†ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³åç­‰ã‚’è¨­å®šï¼‰
npm run dev
# http://localhost:4321
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | æŠ€è¡“ | å½¹å‰² |
|---|---|---|
| ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | Astro | UIãƒ»ç®¡ç†ç”»é¢ |
| èªè¨¼ | Amazon Cognito | Google OIDCèªè¨¼ |
| API | API Gateway | ã‚»ã‚­ãƒ¥ã‚¢ãªAPIãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | AWS Lambda | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ (TypeScript) |
| ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ | DynamoDB | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– (ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰) |
| æ±ºæ¸ˆ | Stripe | ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ |

## ä¸»è¦æ©Ÿèƒ½

### 1. èªè¨¼
- Cognito + Google OIDC
- JWTèªè¨¼ã§APIä¿è­·

### 2. æ±ºæ¸ˆãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç™ºè¡Œ
- Stripeæ±ºæ¸ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
- WebhookçµŒç”±ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”Ÿæˆ
- DynamoDBã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ä¿å­˜

### 3. ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†
- èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¡¨ç¤º

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### Users ãƒ†ãƒ¼ãƒ–ãƒ«
- `userId` (PK): Cognitoãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `stripeCustomerId`: Stripeé¡§å®¢ID
- `createdAt`: ä½œæˆæ—¥æ™‚

### Licenses ãƒ†ãƒ¼ãƒ–ãƒ«
- `licenseId` (PK): ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ID
- `userId` (GSI): ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
- `licenseCode`: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‰
- `purchaseDate`: è³¼å…¥æ—¥æ™‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
â”œâ”€â”€ infrastructure/    # AWS CDK (TypeScriptå°‚ç”¨)
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ common-resource-stack.ts  # å…±é€šè¨­å®šãƒ»ç’°å¢ƒå¤‰æ•°ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ database-stack.ts         # DynamoDB
â”‚   â”‚   â”œâ”€â”€ auth-stack.ts             # Cognito
â”‚   â”‚   â”œâ”€â”€ api-stack.ts              # API Gateway + Lambda
â”‚   â”‚   â””â”€â”€ frontend-stack.ts         # S3 + CloudFront + Route53
â”‚   â”œâ”€â”€ cdk.env                       # ç’°å¢ƒå¤‰æ•°ï¼ˆå®Ÿåœ¨ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰
â”‚   â””â”€â”€ cdk.env.example               # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ backend/          # Lambdaé–¢æ•° (Docker)
â”œâ”€â”€ frontend/         # Astro
â”‚   â”œâ”€â”€ src/lib/auth.ts           # Cognitoèªè¨¼
â”‚   â”œâ”€â”€ src/lib/stripe.ts         # Stripeæ±ºæ¸ˆ
â”‚   â”œâ”€â”€ src/pages/                # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ .env                      # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç’°å¢ƒå¤‰æ•°
â”‚   â””â”€â”€ .env.example              # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â””â”€â”€ docs/            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

## é–‹ç™ºæ–¹é‡

- **ã‚³ã‚¹ãƒˆåŠ¹ç‡**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹æ§‹æˆ
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: ã‚ªãƒ³ãƒ‡ãƒãƒ³ãƒ‰èª²é‡‘
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: JWTèªè¨¼ãƒ»Stripeæ±ºæ¸ˆ
- **æœ€å°å®Ÿè£…**: å¿…è¦æœ€å°é™ã®ã‚³ãƒ¼ãƒ‰
- **ç’°å¢ƒåˆ†é›¢**: dev/prodç’°å¢ƒã®å®Œå…¨åˆ†é›¢
- **TypeScriptå°‚ç”¨**: CDKã¯TypeScriptã®ã¿ä½¿ç”¨
- **Docker Lambda**: Lambdaé–¢æ•°ã¯Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ã§ãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### ğŸ† ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- **[features.md](docs/features.md)** - å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½è©³ç´°
- **[roadmap.md](docs/roadmap.md)** - ä»Šå¾Œã®é–‹ç™ºãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **[setup-guide.md](docs/setup-guide.md)** - è©³ç´°ãªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
- **[deployment.md](docs/deployment.md)** - ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰
- **[api-reference.md](docs/api-reference.md)** - APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹
- **[architecture.md](docs/architecture.md)** - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ
- **[troubleshooting.md](docs/troubleshooting.md)** - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **[google-oauth-test-guide.md](docs/google-oauth-test-guide.md)** - Google OAuthèªè¨¼ãƒ†ã‚¹ãƒˆ

## ğŸ† ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå®Œæˆ

### âœ… MVPå®Œæˆ - å•†ç”¨ãƒ¬ãƒ™ãƒ«æ©Ÿèƒ½
- **Google OAuthèªè¨¼**: ä¸¡ç’°å¢ƒï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ»ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼‰å®Œå…¨å‹•ä½œ
- **Stripeæ±ºæ¸ˆçµ±åˆ**: ãƒ†ã‚¹ãƒˆå®Ÿè£…ãƒ»ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è‡ªå‹•ç”Ÿæˆ
- **Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³**: Astroã‚¢ãƒ—ãƒªãƒ»ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰å‹•ä½œ
- **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã‚¤ãƒ³ãƒ•ãƒ©**: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ãƒ»ã‚³ã‚¹ãƒˆåŠ¹ç‡ãƒ»è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒ«

### ğŸ† å®Œæˆã—ãŸWebã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
```bash
# ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ
cd frontend && npm run dev
# http://localhost:4321/

# ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³
# https://app.yourdomain.com/

# å®Œå…¨å‹•ä½œãƒ•ãƒ­ãƒ¼
# 1. Sign in with Google â†’ èªè¨¼æˆåŠŸ
# 2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¡¨ç¤º â†’ Purchase License
# 3. ãƒ†ã‚¹ãƒˆæˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
```

### è¨­å®šç¢ºèª
```bash
# ç’°å¢ƒç¢ºèª
aws sts get-caller-identity
cdk list --context env=dev

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰èµ·å‹•
cd frontend && npm run dev
# http://localhost:4321/
```

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License - è©³ç´°ã¯[LICENSE](LICENSE)ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§